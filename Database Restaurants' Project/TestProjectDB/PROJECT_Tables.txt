CREATE TABLE RESTAURANTS(
    REST_ID NUMBER,
    RESTAURANT_NAME VARCHAR2 (20 CHAR) NOT NULL UNIQUE,
    constraint restaurant_pk primary key (REST_ID));
    
CREATE TABLE LOCATIONS (
    LOCATION_ID NUMBER,
    LOCATION_NAME VARCHAR2 (20 CHAR) UNIQUE NOT NULL,
    CONSTRAINT location_pk PRIMARY KEY(LOCATION_ID) );
    
CREATE TABLE RESTAURANTS_BRANCHES(
    REST_ID NUMBER,
    LOCATION_ID NUMBER,
    MANAGER_NAME VARCHAR2 (50 CHAR) UNIQUE NOT NULL,
    ADDRESS varchar2 (200 char) NOT NULL,
    CONTACT_NUMBER varchar2(20 char) NOT NULL UNIQUE,
    OPEN_TIME DATE NOT NULL,
    CLOSE_TIME DATE NOT NULL,
    WEEKLY_HOLIDAY varchar2 (10 char),
    CONSTRAINT branch_pk PRIMARY KEY (REST_ID, LOCATION_ID),
    CONSTRAINT rbl_fk FOREIGN KEY (LOCATION_ID) REFERENCES LOCATIONS (LOCATION_ID) ON DELETE CASCADE,
    CONSTRAINT rbr_fk FOREIGN KEY (REST_ID) REFERENCES RESTAURANTS (REST_ID) ON DELETE CASCADE
    );

CREATE TABLE USERS(
    USER_ID NUMBER,
    USERNAME VARCHAR2 (20 CHAR) UNIQUE NOT NULL,
    Email varchar2(50 CHAR) UNIQUE NOT NULL,
    FirstName varchar2(50 CHAR) NOT NULL,
    LastName varchar2(50 CHAR) NOT NULL,
    PASSWORD varchar2(50 CHAR) NOT NULL,
    ACCOUNT_STATUS VARCHAR2(15 CHAR) DEFAULT 'Active' CONSTRAINT  accstatus_chk CHECK (ACCOUNT_STATUS = 'Active' OR ACCOUNT_STATUS = 'Deactive'),
    USER_SCORE NUMBER DEFAULT 0 CONSTRAINT user_score_range CHECK (USER_SCORE >=0 AND USER_SCORE <= 10),
    USER_NUMBER varchar2(20 char) NOT NULL UNIQUE,
    GENDER VARCHAR2(10 CHAR) NOT NULL CONSTRAINT gender_chk CHECK (GENDER = 'Male' OR GENDER = 'Female'),
    CONSTRAINT users_pk PRIMARY KEY (USER_ID)
    );
 
   
CREATE TABLE MENU_ITEMS(
    ITEM_ID NUMBER,
    ITEM_TYPE VARCHAR2 (20 CHAR) NOT NULL,
    ITEM_NAME varchar2(50 CHAR) UNIQUE NOT NULL,
    CONSTRAINT items_pk PRIMARY KEY (ITEM_ID)
    );

CREATE TABLE BRANCH_MENUS(
    REST_ID NUMBER,
    LOCATION_ID NUMBER,
    ITEM_ID NUMBER,
    PRICE NUMBER NOT NULL,
    AVAILABILITY VARCHAR2(5 CHAR) DEFAULT 'YES' CONSTRAINT availability_chk CHECK (AVAILABILITY = 'YES' OR AVAILABILITY = 'NO'),
    OFFER VARCHAR2 (100 CHAR) DEFAULT 'NO OFFER',
    CONSTRAINT bmr_fk FOREIGN KEY (REST_ID) REFERENCES RESTAURANTS (REST_ID) ON DELETE CASCADE,
    CONSTRAINT bml_fk FOREIGN KEY (LOCATION_ID) REFERENCES LOCATIONS (LOCATION_ID) ON DELETE CASCADE,
    CONSTRAINT bmi_fk FOREIGN KEY (ITEM_ID) REFERENCES MENU_ITEMS (ITEM_ID) ON DELETE CASCADE,
    CONSTRAINT bm_pk PRIMARY KEY (REST_ID, LOCATION_ID, ITEM_ID)
    );

CREATE TABLE USERS_MENU_RATING(
    REST_ID NUMBER,
    LOCATION_ID NUMBER,
    ITEM_ID NUMBER,
    USER_ID NUMBER,
    USER_MENU_RATING NUMBER DEFAULT 10 CONSTRAINT user_menu_r CHECK (USER_MENU_RATING >=0 AND USER_MENU_RATING <= 10),
    COMMENTS VARCHAR2 (50 CHAR),
    CONSTRAINT umrr_fk FOREIGN KEY (REST_ID) REFERENCES RESTAURANTS (REST_ID) ON DELETE CASCADE,
    CONSTRAINT umrl_fk FOREIGN KEY (LOCATION_ID) REFERENCES LOCATIONS (LOCATION_ID) ON DELETE CASCADE,
    CONSTRAINT umri_fk FOREIGN KEY (ITEM_ID) REFERENCES MENU_ITEMS (ITEM_ID) ON DELETE CASCADE,
    CONSTRAINT umru_fk FOREIGN KEY (USER_ID) REFERENCES USERS (USER_ID) ON DELETE CASCADE,
    CONSTRAINT umr_pk PRIMARY KEY (REST_ID, LOCATION_ID, ITEM_ID, USER_ID) 
    );
    

CREATE TABLE USERS_BRANCH_RATING(
    REST_ID NUMBER,
    LOCATION_ID NUMBER,
    USER_ID NUMBER,
    USER_BRANCH_RATING NUMBER DEFAULT 10 CONSTRAINT user_branch_r CHECK (USER_BRANCH_RATING >=0 AND USER_BRANCH_RATING <= 10),
    COMMENTS VARCHAR2 (50 CHAR),
    CONSTRAINT ubrr_fk FOREIGN KEY (REST_ID) REFERENCES RESTAURANTS (REST_ID) ON DELETE CASCADE,
    CONSTRAINT ubrl_fk FOREIGN KEY (LOCATION_ID) REFERENCES LOCATIONS (LOCATION_ID) ON DELETE CASCADE,
    CONSTRAINT ubru_fk FOREIGN KEY (USER_ID) REFERENCES USERS (USER_ID) ON DELETE CASCADE,
    CONSTRAINT ubr_pk PRIMARY KEY (REST_ID, LOCATION_ID, USER_ID) 
    );
    

CREATE TABLE ADMINS (
    ADMIN_ID NUMBER,
    ADMIN_USER_NAME VARCHAR2 (50 CHAR) UNIQUE NOT NULL,
    Email varchar2(50 CHAR) UNIQUE NOT NULL,
    FirstName varchar2(50 CHAR) NOT NULL,
    LastName varchar2(50 CHAR) NOT NULL,
    PASSWORD varchar2(50 CHAR) NOT NULL,
    CONSTRAINT admins_pk PRIMARY KEY (ADMIN_ID)
);

CREATE TABLE AUTHORITIES (
    AUTH_ID NUMBER,
    AUTH_USER_NAME VARCHAR2 (50 CHAR) UNIQUE NOT NULL,
    Email varchar2(50 CHAR) UNIQUE NOT NULL,
    COMMITTEE_NAME VARCHAR2 (50 CHAR) NOT NULL unique,
    PASSWORD varchar2(50 CHAR) NOT NULL,
    CONSTRAINT authorities_pk PRIMARY KEY (AUTH_ID)
);


CREATE TABLE USERS_ADMIN_ALLOCATION (
    USER_ID NUMBER,
    ADMIN_ID NUMBER,
    CONSTRAINT uaau_fk FOREIGN KEY (USER_ID) REFERENCES USERS (USER_ID) ON DELETE CASCADE,
    CONSTRAINT uaaa_fk FOREIGN KEY (ADMIN_ID) REFERENCES ADMINS (ADMIN_ID) ON DELETE CASCADE,
    CONSTRAINT uaa_pk PRIMARY KEY (USER_ID, ADMIN_ID)
);

CREATE TABLE BRANCHES_ADMIN_ALLOCATION (
    REST_ID NUMBER,
    LOCATION_ID NUMBER,
    ADMIN_ID NUMBER,
    CONSTRAINT baar_fk FOREIGN KEY (REST_ID) REFERENCES RESTAURANTS (REST_ID) ON DELETE CASCADE,
    CONSTRAINT baaa_fk FOREIGN KEY (ADMIN_ID) REFERENCES ADMINS (ADMIN_ID) ON DELETE CASCADE,
    CONSTRAINT baal_fk FOREIGN KEY (LOCATION_ID) REFERENCES LOCATIONS (LOCATION_ID) ON DELETE CASCADE,
    CONSTRAINT baa_pk PRIMARY KEY (REST_ID, LOCATION_ID, ADMIN_ID)
);


CREATE TABLE RESTAURANTS_AUTHORITY (
    REST_ID NUMBER,
    LOCATION_ID NUMBER,
    AUTH_ID NUMBER NOT NULL,
    CONSTRAINT rar_fk FOREIGN KEY (REST_ID) REFERENCES RESTAURANTS (REST_ID) ON DELETE CASCADE,
    CONSTRAINT raa_fk FOREIGN KEY (AUTH_ID) REFERENCES AUTHORITIES (AUTH_ID) ON DELETE CASCADE,
    CONSTRAINT ral_fk FOREIGN KEY (LOCATION_ID) REFERENCES LOCATIONS (LOCATION_ID) ON DELETE CASCADE,
    CONSTRAINT ra_pk PRIMARY KEY (REST_ID, LOCATION_ID)
);
   
CREATE TABLE AUTHORITIES_ADMIN_ALLOCATION (
    AUTH_ID NUMBER,
    ADMIN_ID NUMBER,
    CONSTRAINT aaaau_fk FOREIGN KEY (AUTH_ID) REFERENCES AUTHORITIES (AUTH_ID) ON DELETE CASCADE,
    CONSTRAINT aaaad_fk FOREIGN KEY (ADMIN_ID) REFERENCES ADMINS (ADMIN_ID) ON DELETE CASCADE,
    CONSTRAINT aaa_pk PRIMARY KEY (AUTH_ID, ADMIN_ID)
);

